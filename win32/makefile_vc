# Make file for SciTE on Windows Visual C++ version
# Copyright 1998-2000 by Neil Hodgson <neilh@scintilla.org>
# The License.txt file describes the conditions under which this software may be distributed.
# This makefile is for using Visual C++ and nmake. 
# The main makefile uses mingw32 gcc and may be more current than this file.

CC = cl
RC = rc
LD = link

PROG	= ../bin/SciTE.exe
PROGSTATIC = ../bin/Sc1.exe

LDFLAGS = /NODEFAULTLIB:LIBC KERNEL32.lib USER32.lib GDI32.lib COMDLG32.lib WINMM.lib COMCTL32.lib ADVAPI32.lib IMM32.lib SHELL32.LIB OLE32.LIB
INCLUDEDIRS=-I ../../scintilla/include -I ../../scintilla/win32 -I ../src 
CXXFLAGS = /TP /Ox /W4

!IFDEF DEBUG
CXXFLAGS=$(CXXFLAGS) /MDd /Zi 
LDFLAGS=/DEBUG $(LDFLAGS)
!ELSE
CXXFLAGS=$(CXXFLAGS) /MD /Zi 
!ENDIF

.cxx.obj:
	$(CC) $(INCLUDEDIRS) $(CXXFLAGS) -c $*.cxx -o $@

.rc.res:
	$(RC) $(INCLUDEDIRS) $*.rc
	
DLLS=..\bin\Scintilla.dll ..\bin\SciLexer.dll

ALL:	$(PROG) $(PROGSTATIC) $(DLLS) ..\bin\SciTEGlobal.properties

clean:
	del /q *.exe *.o *.obj *.dll *.res *.map

..\bin\Scintilla.dll:	..\..\scintilla\bin\Scintilla.dll
	copy ..\..\scintilla\bin\Scintilla.dll $@

..\bin\SciLexer.dll:	..\..\scintilla\bin\SciLexer.dll
	copy ..\..\scintilla\bin\SciLexer.dll $@
	
..\bin\SciTEGlobal.properties:	..\src\SciTEGlobal.properties
	copy ..\src\SciTEGlobal.properties $@

OBJS = SciTEBase.obj SciTEWin.obj \
	..\..\scintilla\win32\WindowAccessor.obj \
	..\..\scintilla\win32\PropSet.obj \
	..\..\scintilla\win32\PlatWin.obj \
	..\..\scintilla\win32\UniConversion.obj

$(PROG): $(OBJS) SciTERes.res
	$(LD) /OUT:$@ $(OBJS) SciTERes.res $(LDFLAGS)
	
OBJSSTATIC = Sc1.obj SciTEBase.obj \
	..\..\scintilla\win32\KeyWords.obj \
	..\..\scintilla\win32\LexCPP.obj \
	..\..\scintilla\win32\LexHTML.obj \
	..\..\scintilla\win32\LexOthers.obj \
	..\..\scintilla\win32\LexPerl.obj \
	..\..\scintilla\win32\LexPython.obj \
	..\..\scintilla\win32\LexSQL.obj \
	..\..\scintilla\win32\LexVB.obj \
	..\..\scintilla\win32\WindowAccessor.obj \
	..\..\scintilla\win32\DocumentAccessor.obj \
	..\..\scintilla\win32\PropSet.obj \
	..\..\scintilla\win32\ScintillaWinL.obj \
	..\..\scintilla\win32\ScintillaBaseL.obj \
	..\..\scintilla\win32\Editor.obj \
	..\..\scintilla\win32\Document.obj \
	..\..\scintilla\win32\CellBuffer.obj \
	..\..\scintilla\win32\ContractionState.obj \
	..\..\scintilla\win32\CallTip.obj \
	..\..\scintilla\win32\PlatWin.obj \
	..\..\scintilla\win32\UniConversion.obj \
	..\..\scintilla\win32\KeyMap.obj \
	..\..\scintilla\win32\Indicator.obj \
	..\..\scintilla\win32\LineMarker.obj \
	..\..\scintilla\win32\Style.obj \
	..\..\scintilla\win32\ViewStyle.obj \
	..\..\scintilla\win32\AutoComplete.obj

SciTEBase.obj: ..\src\SciTEBase.cxx ..\src\SciTEBase.h ..\src\SciTE.h \
	..\..\scintilla\include\Platform.h \
	..\..\scintilla\include\PropSet.h \
	..\..\scintilla\include\Accessor.h \
	..\..\scintilla\include\KeyWords.h \
	..\..\scintilla\include\Scintilla.h \
	..\..\scintilla\include\SciLexer.h
	$(CC) $(INCLUDEDIRS) $(CXXFLAGS) /c ..\src\SciTEBase.cxx /Fo$@
	
SciTEWin.obj: SciTEWin.cxx ..\src\SciTEBase.h ..\src\SciTE.h \
	..\..\scintilla\include\Platform.h \
	..\..\scintilla\include\PropSet.h \
	..\..\scintilla\include\Accessor.h \
	..\..\scintilla\include\KeyWords.h \
	..\..\scintilla\include\Scintilla.h \
	..\..\scintilla\include\SciLexer.h

Sc1.obj: SciTEWin.cxx ..\src\SciTEBase.h ..\src\SciTE.h \
	..\..\scintilla\include\Platform.h \
	..\..\scintilla\include\PropSet.h \
	..\..\scintilla\include\Accessor.h \
	..\..\scintilla\include\KeyWords.h \
	..\..\scintilla\include\Scintilla.h
	$(CC) $(INCLUDEDIRS) $(CXXFLAGS) /D STATIC_BUILD /c SciTEWin.cxx /Fo$@

# A custom rule for .obj files built by scintilla:
..\..\scintilla\win32\PlatWin.obj: 	..\..\scintilla\win32\PlatWin.cxx
	echo You must run the Scintilla makefile to build $*.obj
	fail_the_build # Is there an official way to do this?
	

$(PROGSTATIC): $(OBJSSTATIC) SciTERes.res
	$(LD) /OUT:$@ $(OBJSSTATIC) SciTERes.res $(LDFLAGS)
